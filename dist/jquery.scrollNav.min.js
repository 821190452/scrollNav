/*! scrollNav - v2.0.2 - 2013-11-10
* http://scrollnav.com
* Copyright (c) 2013 James Wilson; Licensed MIT */
(function(s){var t=function(t,e,i,n){if(s(t).length>0){var o=s(t).offset().top;e=n?e:0,s("html:not(:animated),body:not(:animated)").animate({scrollTop:o-i},e)}},e=function(){return window.location.hash},i={classes:{loading:"sn-loading",failed:"sn-failed",success:"sn-active"},defaults:{sections:"h2",subSections:!1,sectionElem:"section",showHeadline:!0,headlineText:"Scroll To",showTopLink:!0,topLinkText:"Top",fixedMargin:40,scrollOffset:40,animated:!0,speed:500,insertLocation:"insertBefore",arrowKeys:!1},_set_body_class:function(t){"loading"===t?s("body").addClass(i.classes.loading):"success"===t?s("body").removeClass(i.classes.loading).addClass(i.classes.success):s("body").removeClass(i.classes.loading).addClass(i.classes.failed)},_find_sections:function(t){var e=i.settings.sections,n=[];if(i.settings.showTopLink){var o=t.children().first();o.is(e)||n.push(o.nextUntil(e).andSelf())}t.find(e).each(function(){n.push(s(this).nextUntil(e).andSelf())}),i.sections={raw:n}},_setup_sections:function(t){var e=[];s(t).each(function(t){var n=[],o=s(this),a="scrollNav-"+(t+1),l=function(){return 0===t},c=function(){return!o.eq(0).is(i.settings.sections)},r=i.settings.showTopLink&&l()&&c()?i.settings.topLinkText:o.filter(i.settings.sections).text();if(i.settings.subSections){var d=o.filter(i.settings.subSections);d.length>0&&(d.each(function(t){var e=a+"-"+(t+1),i=s(this).text(),l=o.filter(s(this).nextUntil(d).andSelf());l.wrapAll('<div id="'+e+'" class="scroll-nav__sub-section" />'),n.push({id:e,text:i})}),o=s(s(this).filter(i.settings.sections)).nextUntil(i.settings.sections).andSelf())}o.wrapAll("<"+i.settings.sectionElem+' id="'+a+'" class="scroll-nav__section" />'),e.push({id:a,text:r,sub_sections:n})}),i.sections.data=e},_setup_nav:function(t){var e=s("<span />",{"class":"scroll-nav__heading",text:i.settings.headlineText}),n=s("<div />",{"class":"scroll-nav__wrapper"}),o=s("<nav />",{"class":"scroll-nav",role:"navigation"}),a=s("<ol />",{"class":"scroll-nav__list"});s.each(t,function(t){var e,i=0===t?s("<li />",{"class":"scroll-nav__item active"}):s("<li />",{"class":"scroll-nav__item"}),n=s("<a />",{href:"#"+this.id,"class":"scroll-nav__link",text:this.text});this.sub_sections.length>0&&(i.addClass("is-parent-item"),e=s("<ol />",{"class":"scroll-nav__sub-list"}),s.each(this.sub_sections,function(){var t=s("<li />",{"class":"scroll-nav__sub-item"}),i=s("<a />",{href:"#"+this.id,"class":"scroll-nav__sub-link",text:this.text});e.append(t.append(i))})),a.append(i.append(n).append(e))}),i.settings.showHeadline?o.append(n.append(e).append(a)):o.append(n.append(a)),i.nav=o},_insert_nav:function(){var s=i.settings.insertLocation,t=i.settings.insertTarget;i.nav[s](t)},_setup_pos:function(){var t=i.nav,e=s(window).height(),n=t.offset().top;s.each(i.sections.data,function(){var t=s("#"+this.id),e=t.height();this.top_offset=t.offset().top,this.bottom_offset=this.top_offset+e}),i.dims={vp_height:e,nav_offset:n}},_check_pos:function(){var t=i.nav,e=s(window).scrollTop(),n=e+i.settings.scrollOffset,o=e+i.dims.vp_height-i.settings.scrollOffset;i.sections.active=[],e>i.dims.nav_offset-i.settings.fixedMargin?t.addClass("fixed"):t.removeClass("fixed"),s.each(i.sections.data,function(){(this.top_offset>n&&o>this.top_offset||this.bottom_offset>n&&o>this.bottom_offset||n>this.top_offset&&this.bottom_offset>o)&&i.sections.active.push(this)}),t.find(".scroll-nav__item").removeClass("active").removeClass("in-view"),s.each(i.sections.active,function(s){0===s?t.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("active").addClass("in-view"):t.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("in-view"),s++})},_init_scroll_listener:function(){s(window).scroll(function(){i._check_pos()})},_init_resize_listener:function(){s(window).resize(function(){i._setup_pos(),i._check_pos()})},_init_click_listener:function(){s(".scroll-nav").find("a").click(function(e){e.preventDefault();var n=s(this).attr("href"),o=i.settings.speed,a=i.settings.scrollOffset,l=i.settings.animated;t(n,o,a,l)})},_init_keyboard_listener:function(e){i.settings.arrowKeys&&s(document).keydown(function(s){if(40===s.keyCode||38===s.keyCode){var n=function(s){var t=0,n=e.length;for(t;n>t;t++)if(e[t].id===i.sections.active[0].id){var o=40===s?t+1:t-1,a=void 0===e[o]?void 0:e[o].id;return a}},o=n(s.keyCode);if(void 0!==o){s.preventDefault();var a="#"+o,l=i.settings.speed,c=i.settings.scrollOffset,r=i.settings.animated;t(a,l,c,r)}}})},init:function(n){return this.each(function(){var o=s(this);i.settings=s.extend({},i.defaults,n),i.settings.insertTarget=i.settings.insertTarget?s(i.settings.insertTarget):o,o.length>0?(i._set_body_class("loading"),i._find_sections(o),o.find(i.settings.sections).length>0?(i._setup_sections(i.sections.raw),i._setup_nav(i.sections.data),i.settings.insertTarget.length>0?(i._insert_nav(),i._setup_pos(),i._check_pos(),i._init_scroll_listener(),i._init_resize_listener(),i._init_click_listener(),i._init_keyboard_listener(i.sections.data),i._set_body_class("success"),t(e())):(console.log('Build failed, scrollNav could not find "'+i.settings.insertTarget+'"'),i._set_body_class("failed"))):(console.log('Build failed, scrollNav could not find any "'+i.settings.sections+'s" inside of "'+o.selector+'"'),i._set_body_class("failed"))):(console.log('Build failed, scrollNav could not find "'+o.selector+'"'),i._set_body_class("failed"))})},destroy:function(){return this.each(function(){s("body").removeClass("sn-loading sn-active sn-failed"),s(".scroll-nav").remove(),i.settings=[]})}};s.fn.scrollNav=function(){var t,e=arguments[0];if(i[e])e=i[e],t=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof e&&e)return s.error("Method "+e+" does not exist in the scrollNav plugin"),this;e=i.init,t=arguments}return e.apply(this,t)}})(jQuery);