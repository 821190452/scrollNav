/*! scrollNav - v2.0.0 - 2013-10-08
* http://scrollnav.com
* Copyright (c) 2013 James Wilson; Licensed MIT */
(function(t){t.fn.scrollNav=function(n){var s,i,e,o,a=t.extend({sections:"h2",subSections:!1,showHeadline:!0,headlineText:"Scroll To",showTopLink:!0,topLinkText:"Top",fixedMargin:40,scrollOffset:40,animated:!0,speed:500,location:"insertBefore",arrowKeys:!1},n),l=[],f=[],c=[],d=this,r=t("<span />",{"class":"scroll-nav__heading",text:a.headlineText}),h=t("<div />",{"class":"scroll-nav__wrapper"}),u=t("<nav />",{"class":"scroll-nav",role:"navigation"}),p=function(){return window.location.hash},v=function(){t("body").addClass("sn-loading")},_=function(n){n?t("body").removeClass("sn-loading").addClass("sn-active"):t("body").removeClass("sn-loading").addClass("sn-failed")},w=function(){if(a.showTopLink){var n=d.children().first();n.is(a.sections)||l.push(n.nextUntil(a.sections).andSelf())}d.find(a.sections).each(function(){l.push(t(this).nextUntil(a.sections).andSelf())})},m=function(){t(l).each(function(n){var s=[],i=t(this),e="scrollNav-"+(n+1),o=i.offset().top,l=function(){return 0===n},c=function(){return!i.eq(0).is(a.sections)},d=a.showTopLink&&l()&&c()?a.topLinkText:i.filter(a.sections).text();if(a.subSections){var r=i.filter(a.subSections);r.length>0&&(r.each(function(n){var o=e+"-"+(n+1),a=t(this).offset().top,l=t(this).text(),f=i.filter(t(this).nextUntil(r).andSelf());f.wrapAll('<div id="'+o+'" class="scroll-nav__sub-section" />'),s.push({id:o,offset:a,text:l})}),i=t(this).nextUntil(a.sections).andSelf())}i.wrapAll('<section id="'+e+'" />'),f.push({id:e,offset:o,text:d,subSections:s})})},x=function(){var n=t("<ol />",{"class":"scroll-nav__list"});t.each(f,function(s){var i,e=0===s?t("<li />",{"class":"scroll-nav__item active"}):t("<li />",{"class":"scroll-nav__item"}),o=t("<a />",{href:"#"+this.id,"class":"scroll-nav__link",text:this.text});this.subSections.length>0&&(e.addClass("is-parent-item"),i=t("<ol />",{"class":"scroll-nav__sub-list"}),t.each(this.subSections,function(){var n=t("<li />",{"class":"scroll-nav__sub-item"}),s=t("<a />",{href:"#"+this.id,"class":"scroll-nav__sub-link",text:this.text});i.append(n.append(s))})),n.append(e.append(o).append(i))}),a.showHeadline?u.append(h.append(r).append(n)):u.append(h.append(n))},g=function(){u[a.location](d)},b=function(){s=t(window).height(),i=u.offset().top,t.each(f,function(){var n=t("#"+this.id),s=n.height();this.topOffset=n.offset().top,this.bottomOffset=this.topOffset+s})},C=function(){var n=t(window).scrollTop();e=n+a.scrollOffset,o=n+s-a.scrollOffset,c.length=0,n>i-a.fixedMargin?u.addClass("fixed"):u.removeClass("fixed"),t.each(f,function(){(this.topOffset>e&&o>this.topOffset||this.bottomOffset>e&&o>this.bottomOffset||e>this.topOffset&&this.bottomOffset>o)&&c.push(this)}),u.find(".scroll-nav__item").removeClass("active").removeClass("in-view"),t.each(c,function(t){0===t?u.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("active").addClass("in-view"):u.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("in-view"),t++})},O=function(){t(window).resize(function(){b(),C()}),t(window).scroll(function(){C()})},k=function(n){if(t(n).length>0){var s=t(n).offset().top,i=a.animated?a.speed:0;t("html:not(:animated),body:not(:animated)").animate({scrollTop:s-a.scrollOffset},i)}},y=function(){t(".scroll-nav").find("a").click(function(n){n.preventDefault(),k(t(this).attr("href"))})},S=function(){a.arrowKeys&&t(document).keydown(function(t){if(40===t.keyCode||38===t.keyCode){var n=function(t){var n=0,s=f.length;for(n;s>n;n++)if(f[n].id===c[0].id){var i=40===t?n+1:n-1,e=void 0===f[i]?void 0:f[i].id;return e}},s=n(t.keyCode);void 0!==s&&(t.preventDefault(),k("#"+s))}})},T=function(n){if(n&&t(n).length>0){var s=t(n).offset().top;(e>s||s>o)&&k(n)}};return d.length>0?(v(),w(),d.find(a.sections).length>0?(m(),x(),g(),b(),C(),O(),y(),S(),_(!0),T(p())):(console.log('Build failed, scrollNav could not find any "'+a.sections+'s" inside of "'+d.selector+'"'),_(!1))):(console.log('Build failed, scrollNav could not find "'+d.selector+'"'),_(!1)),this}})(jQuery);